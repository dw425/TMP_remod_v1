import{a as h,j as e}from"./state-Cs2e8pUQ.js";import{e as f,j as A,o as L,E as w}from"./index-BFBTFrn8.js";import{u as k}from"./useAlerts-C9P_ItF6.js";import{r as P,a as _,i as U,c as B,h as C,b as H,d as j,f as $}from"./downloadService-CoA7xjay.js";import{M as W,u as G,D as N}from"./downloadCatalog-CYDX3gRw.js";import{B as g}from"./Button-BfaFrLlN.js";import"./vendor-CXKupAPx.js";const M="https://api.github.com";function D(){const t={Accept:"application/vnd.github.v3+json"};return f.VITE_GITHUB_DOWNLOAD_TOKEN&&(t.Authorization=`Bearer ${f.VITE_GITHUB_DOWNLOAD_TOKEN}`),t}function v(){return!!f.VITE_GITHUB_DOWNLOAD_TOKEN}async function F(t){if(!t.githubRepo||!t.githubPath)throw new Error("Asset does not have GitHub source configured");const c=f.VITE_GITHUB_ORG,r=t.githubBranch||"main",s=`${M}/repos/${c}/${t.githubRepo}/contents/${t.githubPath}?ref=${r}`,a=await fetch(s,{headers:D()});if(!a.ok)throw a.status===404?new Error("File not found in repository"):a.status===403?new Error("Access denied. Check GitHub token configuration."):new Error(`GitHub API error: ${a.status}`);const i=await a.json();if(i.content&&i.encoding==="base64"){const l=atob(i.content.replace(/\n/g,"")),d=new Uint8Array(l.length);for(let u=0;u<l.length;u++)d[u]=l.charCodeAt(u);return new Blob([d],{type:"application/octet-stream"})}if(i.download_url){const l=new URL(i.download_url);if(!l.hostname.endsWith("githubusercontent.com")&&!l.hostname.endsWith("github.com"))throw new Error("Unexpected download URL domain");const d=await fetch(i.download_url,{headers:D()});if(!d.ok)throw new Error(`Download failed: ${d.status}`);return d.blob()}throw new Error("Unable to download file from GitHub")}function V(t,c,r){return new Promise(s=>{const a=new FileReader;a.onload=()=>{const i=a.result,l=`# Licensed to: ${c}
# Download ID: ${r}
# Date: ${new Date().toISOString()}
# PROPRIETARY - DO NOT DISTRIBUTE

`;s(new Blob([l+i],{type:"application/octet-stream"}))},a.onerror=()=>s(t),a.readAsText(t)})}function Y(t){return t.fileType==="notebook"||t.fileType==="report"}function T(t,c){const r=URL.createObjectURL(t),s=document.createElement("a");s.href=r,s.download=c,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(r)}function z(){const{user:t,isAuthenticated:c}=A(),r=L(),{showInfo:s,showSuccess:a,showError:i,showWarning:l}=k(),[d,u]=h.useState(null),[p,m]=h.useState(!1),o=h.useCallback(async n=>{if(!t)return;P(t.id),_(t.id,n.assetId,n.fileName),r(w.DOWNLOAD_INITIATED,{assetId:n.assetId,fileType:n.fileType});const y=crypto.randomUUID();if(n.githubRepo&&n.githubPath&&v())try{let x=await F(n);Y(n)&&(x=await V(x,t.email,y)),T(x,n.fileName),a("Download complete",n.displayName),r(w.DOWNLOAD_COMPLETED,{assetId:n.assetId,source:"github"});return}catch{s("Using demo download","GitHub source unavailable — generating demo file.")}const R=`${`# Licensed to: ${t.email}
# Download ID: ${y}
# Date: ${new Date().toISOString()}
# PROPRIETARY - DO NOT DISTRIBUTE

`}# ${n.displayName} v${n.version}
# This is a demo download.
`,S=new Blob([R],{type:"application/octet-stream"});T(S,n.fileName),a("Download complete",n.displayName),r(w.DOWNLOAD_COMPLETED,{assetId:n.assetId,source:"demo"})},[t,r,a,s]),b=h.useCallback(n=>{if(!c||!t){l("Login Required","Please sign in to download content.");return}if(!U(t.id,n.productSlug)){i("Not Available","You need to purchase this product to download it."),r("download_blocked",{assetId:n.assetId,reason:"not_entitled"});return}if(!B(t.id)){i("Rate Limited","Too many downloads. Please try again in an hour."),r("download_blocked",{assetId:n.assetId,reason:"rate_limited"});return}if(!C(t.id)){u(n),m(!0);return}s("Starting download...",n.displayName),o(n)},[c,t,r,s,l,i,o]),E=h.useCallback(()=>{!t||!d||(H(t.id),m(!1),s("Starting download...",d.displayName),o(d),u(null))},[t,d,s,o]),O=h.useCallback(()=>{m(!1),u(null)},[]);return{download:b,showTerms:p,onAcceptTerms:E,onDeclineTerms:O}}function K({isOpen:t,onAccept:c,onDecline:r}){return e.jsx(W,{isOpen:t,onClose:r,title:"License Agreement",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"max-h-64 overflow-y-auto border border-gray-200 p-4 text-sm text-gray-600 space-y-3",children:[e.jsx("p",{className:"font-bold text-gray-900",children:"Blueprint Professional Consulting Services - Software License Agreement"}),e.jsx("p",{children:"By downloading this software, you agree to the following terms:"}),e.jsxs("p",{children:[e.jsx("strong",{children:"1. License Grant."})," BPCS grants you a non-exclusive, non-transferable license to use this software solely within your organization for internal business purposes."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"2. Restrictions."})," You may not: (a) distribute, sublicense, or transfer this software to any third party; (b) reverse engineer, decompile, or disassemble the software; (c) remove any proprietary notices or license headers; (d) use the software to build competing products."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"3. Intellectual Property."})," All intellectual property rights in the software remain with BPCS. This license does not grant you ownership of the software."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"4. Watermarking."})," Downloaded files contain embedded license information including your email address and a unique download identifier for audit purposes."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"5. Termination."})," This license terminates automatically if you violate any of these terms. Upon termination, you must destroy all copies of the software."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"6. Disclaimer."}),' THE SOFTWARE IS PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED.']})]}),e.jsxs("div",{className:"flex gap-3 justify-end pt-2",children:[e.jsx(g,{variant:"secondary",onClick:r,children:"Decline"}),e.jsx(g,{onClick:c,children:"Accept & Download"})]})]})})}const I={notebook:"Jupyter Notebook",bundle:"Archive Bundle",wheel:"Python Wheel",report:"Report Template"};function ne(){const{user:t}=A(),{download:c,showTerms:r,onAcceptTerms:s,onDeclineTerms:a}=z(),{isEntitled:i}=G(),[l,d]=h.useState(()=>t?j(t.id):[]);if(!t)return null;const u=N.filter(o=>i(o.productSlug)),p=N.filter(o=>!i(o.productSlug)),m=o=>{c(o),setTimeout(()=>{d(j(t.id))},100)};return e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-12",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Downloads"}),!v()&&e.jsxs("div",{className:"mb-6 p-3 bg-blue-50 border border-blue-200 text-blue-800 text-sm",children:[e.jsx("span",{className:"font-medium",children:"Demo Mode"})," — Real downloads available after deployment configuration."]}),u.length>0&&e.jsxs("div",{className:"mb-10",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"Available Downloads"}),e.jsx("div",{className:"space-y-3",children:u.map(o=>e.jsxs("div",{className:"bg-white border border-gray-300 p-5 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-gray-900",children:o.displayName}),e.jsxs("p",{className:"text-sm text-gray-500",children:[I[o.fileType]||o.fileType," · v",o.version," ·"," ",$(o.sizeBytes)]})]}),e.jsx(g,{onClick:()=>m(o),children:"Download"})]},o.assetId))})]}),p.length>0&&e.jsxs("div",{className:"mb-10",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"Locked"}),e.jsx("div",{className:"space-y-3",children:p.map(o=>e.jsxs("div",{className:"bg-gray-50 border border-gray-200 p-5 flex items-center justify-between opacity-60",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-gray-700",children:o.displayName}),e.jsxs("p",{className:"text-sm text-gray-400",children:[I[o.fileType]||o.fileType," · v",o.version]})]}),e.jsx("span",{className:"text-sm text-gray-400 font-medium",children:"Purchase Required"})]},o.assetId))})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"Download History"}),l.length===0?e.jsx("div",{className:"bg-white border border-gray-300 p-8 text-center",children:e.jsx("p",{className:"text-gray-500",children:"No downloads yet."})}):e.jsx("div",{className:"bg-white border border-gray-300",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 bg-gray-50",children:[e.jsx("th",{className:"text-left px-4 py-3 font-medium text-gray-700",children:"File"}),e.jsx("th",{className:"text-left px-4 py-3 font-medium text-gray-700",children:"Date"})]})}),e.jsx("tbody",{children:l.map((o,b)=>e.jsxs("tr",{className:"border-b border-gray-100 last:border-0",children:[e.jsx("td",{className:"px-4 py-3 text-gray-900",children:o.fileName}),e.jsx("td",{className:"px-4 py-3 text-gray-500",children:new Date(o.downloadedAt).toLocaleString()})]},`${o.assetId}-${b}`))})]})})]}),e.jsx(K,{isOpen:r,onAccept:s,onDecline:a})]})}export{ne as default};
