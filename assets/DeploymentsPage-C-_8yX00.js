import{a as y,j as e}from"./state-Cs2e8pUQ.js";import{e as N,a as D,E as h}from"./index-E-BM5zLk.js";import{r as k,u as v,g as f}from"./useDatabricksAuth-CjmqOslG.js";import{u as C}from"./useAlerts-_7d1GKy-.js";import{M as I,u as U,D as S}from"./downloadCatalog-BGSmjaPo.js";import{B as m}from"./Button-BZReDrNH.js";import"./vendor-D7HEtn7k.js";import"./charts-HkUfyz1_.js";import"./downloadService-CoA7xjay.js";function A(){const{user:s}=N(),a=D(),{showSuccess:n,showError:c,showInfo:d}=C(),[x,i]=y.useState(!1);return{deploy:y.useCallback(async(r,o)=>{if(s){i(!0),d("Deploying...",`Importing ${r.productName} to Databricks workspace`),a(h.DEPLOY_INITIATED,{assetId:r.assetId,workspaceUrl:o.workspaceUrl});try{await new Promise(b=>setTimeout(b,2e3));const l=`/Users/${s.email}/Blueprint/${r.productName}`,p={id:crypto.randomUUID(),assetId:r.assetId,productName:r.productName,workspaceUrl:o.workspaceUrl,importPath:l,deployedAt:new Date().toISOString(),status:"success"};return k(s.id,p),n("Deployment successful",`${r.productName} deployed to ${l}`),a(h.DEPLOY_COMPLETED,{assetId:r.assetId,workspaceUrl:o.workspaceUrl,importPath:l}),p}catch(l){return c("Deployment failed","Please check your workspace connection and try again."),a("deploy_failed",{assetId:r.assetId,error:String(l)}),s&&k(s.id,{id:crypto.randomUUID(),assetId:r.assetId,productName:r.productName,workspaceUrl:o.workspaceUrl,importPath:"",deployedAt:new Date().toISOString(),status:"failed"}),null}finally{i(!1)}}},[s,a,n,c,d]),deploying:x}}function E({isOpen:s,onClose:a,onConnect:n,isConnecting:c}){const[d,x]=y.useState(""),i=r=>{r.preventDefault();const o=d.replace(/\/+$/,"");n(o)};return e.jsx(I,{isOpen:s,onClose:a,title:"Connect to Databricks",children:e.jsxs("form",{onSubmit:i,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"databricks-url",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Workspace URL"}),e.jsx("input",{id:"databricks-url",type:"url",value:d,onChange:r=>x(r.target.value),placeholder:"https://adb-1234567890.azuredatabricks.net",required:!0,className:"w-full border border-gray-300 dark:border-slate-600 px-3 py-2 text-gray-900 dark:text-gray-100 bg-white dark:bg-slate-800 focus:outline-none focus:border-blueprint-blue focus:ring-1 focus:ring-blueprint-blue"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Your Azure Databricks or AWS Databricks workspace URL"})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-800 p-3 text-sm text-blue-700 dark:text-blue-200",children:"You'll be redirected to authenticate with your Databricks credentials. Your credentials are never stored by Blueprint Marketplace."}),e.jsxs("div",{className:"flex gap-3 justify-end pt-2",children:[e.jsx(m,{variant:"secondary",onClick:a,type:"button",children:"Cancel"}),e.jsx(m,{type:"submit",disabled:c||!d,children:c?"Connecting...":"Connect"})]})]})})}function _(){const{user:s}=N(),{connection:a,isConnected:n,isConnecting:c,connect:d,disconnect:x}=v(),{deploy:i,deploying:u}=A(),{isEntitled:r}=U(),[o,l]=y.useState(!1),[p,b]=y.useState(()=>s?f(s.id):[]);if(!s)return null;const g=S.filter(t=>r(t.productSlug)&&(t.fileType==="notebook"||t.fileType==="bundle")),j=async t=>{if(!a){l(!0);return}await i({assetId:t.assetId,productName:t.displayName,fileName:t.fileName},a),b(f(s.id))},w=t=>{d(t),l(!1)};return e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-12",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 mb-2",children:"Deployments"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-8",children:"Deploy products directly to your Databricks workspace."}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-700 p-6 mb-8",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 dark:text-gray-100 mb-3",children:"Databricks Workspace"}),n&&a?e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"w-3 h-3 bg-green-500 inline-block"}),e.jsxs("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Connected to ",a.workspaceUrl]})]}),e.jsx(m,{variant:"secondary",onClick:x,children:"Disconnect"})]}):e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No workspace connected"}),e.jsx(m,{onClick:()=>l(!0),children:"Connect Workspace"})]})]}),g.length>0&&e.jsxs("div",{className:"mb-10",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 dark:text-gray-100 mb-4",children:"Available for Deployment"}),e.jsx("div",{className:"space-y-3",children:g.map(t=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-700 p-5 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-gray-900 dark:text-gray-100",children:t.displayName}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["v",t.version]})]}),e.jsx(m,{onClick:()=>j(t),disabled:u,children:u?"Deploying...":"Deploy"})]},t.assetId))})]}),g.length===0&&e.jsx("div",{className:"bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-700 p-8 text-center mb-10",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No deployable products available. Purchase products to deploy them."})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 dark:text-gray-100 mb-4",children:"Deployment History"}),p.length===0?e.jsx("div",{className:"bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-700 p-8 text-center",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No deployments yet."})}):e.jsx("div",{className:"bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-700",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-900",children:[e.jsx("th",{className:"text-left px-4 py-3 font-medium text-gray-700 dark:text-gray-300",children:"Product"}),e.jsx("th",{className:"text-left px-4 py-3 font-medium text-gray-700 dark:text-gray-300",children:"Workspace"}),e.jsx("th",{className:"text-left px-4 py-3 font-medium text-gray-700 dark:text-gray-300",children:"Status"}),e.jsx("th",{className:"text-left px-4 py-3 font-medium text-gray-700 dark:text-gray-300",children:"Date"})]})}),e.jsx("tbody",{children:p.map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-slate-700 last:border-0",children:[e.jsx("td",{className:"px-4 py-3 text-gray-900 dark:text-gray-100",children:t.productName}),e.jsx("td",{className:"px-4 py-3 text-gray-500 dark:text-gray-400 text-xs truncate max-w-[200px]",children:t.workspaceUrl}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-0.5 text-xs font-medium border ${t.status==="success"?"bg-green-50 text-green-700 border-green-200":"bg-red-50 text-red-700 border-red-200"}`,children:t.status})}),e.jsx("td",{className:"px-4 py-3 text-gray-500 dark:text-gray-400",children:new Date(t.deployedAt).toLocaleString()})]},t.id))})]})})]}),e.jsx(E,{isOpen:o,onClose:()=>l(!1),onConnect:w,isConnecting:c})]})}export{_ as default};
