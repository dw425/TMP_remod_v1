import{a as u,j as e}from"./state-Cs2e8pUQ.js";import{j as N,o as D,E as g}from"./index-BFBTFrn8.js";import{r as f,u as v,g as j}from"./useDatabricksAuth-DFpKUedV.js";import{u as C}from"./useAlerts-C9P_ItF6.js";import{M as I,u as U,D as S}from"./downloadCatalog-CYDX3gRw.js";import{B as x}from"./Button-BfaFrLlN.js";import"./vendor-CXKupAPx.js";import"./downloadService-CoA7xjay.js";function A(){const{user:r}=N(),a=D(),{showSuccess:d,showError:n,showInfo:c}=C(),[p,i]=u.useState(!1);return{deploy:u.useCallback(async(t,o)=>{if(r){i(!0),c("Deploying...",`Importing ${t.productName} to Databricks workspace`),a(g.DEPLOY_INITIATED,{assetId:t.assetId,workspaceUrl:o.workspaceUrl});try{await new Promise(b=>setTimeout(b,2e3));const l=`/Users/${r.email}/Blueprint/${t.productName}`,m={id:crypto.randomUUID(),assetId:t.assetId,productName:t.productName,workspaceUrl:o.workspaceUrl,importPath:l,deployedAt:new Date().toISOString(),status:"success"};return f(r.id,m),d("Deployment successful",`${t.productName} deployed to ${l}`),a(g.DEPLOY_COMPLETED,{assetId:t.assetId,workspaceUrl:o.workspaceUrl,importPath:l}),m}catch(l){return n("Deployment failed","Please check your workspace connection and try again."),a("deploy_failed",{assetId:t.assetId,error:String(l)}),r&&f(r.id,{id:crypto.randomUUID(),assetId:t.assetId,productName:t.productName,workspaceUrl:o.workspaceUrl,importPath:"",deployedAt:new Date().toISOString(),status:"failed"}),null}finally{i(!1)}}},[r,a,d,n,c]),deploying:p}}function E({isOpen:r,onClose:a,onConnect:d,isConnecting:n}){const[c,p]=u.useState(""),i=t=>{t.preventDefault();const o=c.replace(/\/+$/,"");d(o)};return e.jsx(I,{isOpen:r,onClose:a,title:"Connect to Databricks",children:e.jsxs("form",{onSubmit:i,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"databricks-url",className:"block text-sm font-medium text-gray-700 mb-1",children:"Workspace URL"}),e.jsx("input",{id:"databricks-url",type:"url",value:c,onChange:t=>p(t.target.value),placeholder:"https://adb-1234567890.azuredatabricks.net",required:!0,className:"w-full border border-gray-300 px-3 py-2 text-gray-900 bg-white focus:outline-none focus:border-blueprint-blue focus:ring-1 focus:ring-blueprint-blue"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Your Azure Databricks or AWS Databricks workspace URL"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 p-3 text-sm text-blue-700",children:"You'll be redirected to authenticate with your Databricks credentials. Your credentials are never stored by Blueprint Marketplace."}),e.jsxs("div",{className:"flex gap-3 justify-end pt-2",children:[e.jsx(x,{variant:"secondary",onClick:a,type:"button",children:"Cancel"}),e.jsx(x,{type:"submit",disabled:n||!c,children:n?"Connecting...":"Connect"})]})]})})}function B(){const{user:r}=N(),{connection:a,isConnected:d,isConnecting:n,connect:c,disconnect:p}=v(),{deploy:i,deploying:y}=A(),{isEntitled:t}=U(),[o,l]=u.useState(!1),[m,b]=u.useState(()=>r?j(r.id):[]);if(!r)return null;const h=S.filter(s=>t(s.productSlug)&&(s.fileType==="notebook"||s.fileType==="bundle")),k=async s=>{if(!a){l(!0);return}await i({assetId:s.assetId,productName:s.displayName,fileName:s.fileName},a),b(j(r.id))},w=s=>{c(s),l(!1)};return e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-12",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Deployments"}),e.jsx("p",{className:"text-gray-500 mb-8",children:"Deploy products directly to your Databricks workspace."}),e.jsxs("div",{className:"bg-white border border-gray-300 p-6 mb-8",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-3",children:"Databricks Workspace"}),d&&a?e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"w-3 h-3 bg-green-500 inline-block"}),e.jsxs("span",{className:"text-sm text-gray-700",children:["Connected to ",a.workspaceUrl]})]}),e.jsx(x,{variant:"secondary",onClick:p,children:"Disconnect"})]}):e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"No workspace connected"}),e.jsx(x,{onClick:()=>l(!0),children:"Connect Workspace"})]})]}),h.length>0&&e.jsxs("div",{className:"mb-10",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"Available for Deployment"}),e.jsx("div",{className:"space-y-3",children:h.map(s=>e.jsxs("div",{className:"bg-white border border-gray-300 p-5 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-gray-900",children:s.displayName}),e.jsxs("p",{className:"text-sm text-gray-500",children:["v",s.version]})]}),e.jsx(x,{onClick:()=>k(s),disabled:y,children:y?"Deploying...":"Deploy"})]},s.assetId))})]}),h.length===0&&e.jsx("div",{className:"bg-white border border-gray-300 p-8 text-center mb-10",children:e.jsx("p",{className:"text-gray-500",children:"No deployable products available. Purchase products to deploy them."})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"Deployment History"}),m.length===0?e.jsx("div",{className:"bg-white border border-gray-300 p-8 text-center",children:e.jsx("p",{className:"text-gray-500",children:"No deployments yet."})}):e.jsx("div",{className:"bg-white border border-gray-300",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 bg-gray-50",children:[e.jsx("th",{className:"text-left px-4 py-3 font-medium text-gray-700",children:"Product"}),e.jsx("th",{className:"text-left px-4 py-3 font-medium text-gray-700",children:"Workspace"}),e.jsx("th",{className:"text-left px-4 py-3 font-medium text-gray-700",children:"Status"}),e.jsx("th",{className:"text-left px-4 py-3 font-medium text-gray-700",children:"Date"})]})}),e.jsx("tbody",{children:m.map(s=>e.jsxs("tr",{className:"border-b border-gray-100 last:border-0",children:[e.jsx("td",{className:"px-4 py-3 text-gray-900",children:s.productName}),e.jsx("td",{className:"px-4 py-3 text-gray-500 text-xs truncate max-w-[200px]",children:s.workspaceUrl}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-0.5 text-xs font-medium border ${s.status==="success"?"bg-green-50 text-green-700 border-green-200":"bg-red-50 text-red-700 border-red-200"}`,children:s.status})}),e.jsx("td",{className:"px-4 py-3 text-gray-500",children:new Date(s.deployedAt).toLocaleString()})]},s.id))})]})})]}),e.jsx(E,{isOpen:o,onClose:()=>l(!1),onConnect:w,isConnecting:n})]})}export{B as default};
