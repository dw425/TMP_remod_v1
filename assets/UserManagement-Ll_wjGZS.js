import{a as l,j as e}from"./state-Cs2e8pUQ.js";import{S as k}from"./SEO-DQvF1Eq3.js";import{c as j,f as C,g as D,h as A}from"./index-BFBTFrn8.js";import"./vendor-CXKupAPx.js";function d(){try{return A().map(a=>({...a,loginCount:1}))}catch{return[]}}function L(o){try{const a=localStorage.getItem("blueprint_orders");return a?JSON.parse(a).filter(p=>p.contactEmail===o):[]}catch{return[]}}function _(){const[o,a]=l.useState([]),[n,p]=l.useState("lastLogin"),[y,u]=l.useState("desc"),[N,f]=l.useState(null),[v,m]=l.useState(null);l.useEffect(()=>{async function t(){try{const s=await j();s.length>0?a(s):a(d())}catch{a(d())}}t()},[]);const g=t=>{t===n?u(s=>s==="asc"?"desc":"asc"):(p(t),u("desc"))},b=async()=>{try{const t=await j();t.length>0?a(t):a(d())}catch{a(d())}},w=t=>{C(t),m(null),b()},S=(t,s)=>{D(t,s),b()},i=[...o].sort((t,s)=>{const c=t[n]||"",r=s[n]||"",x=c.localeCompare(r);return y==="asc"?x:-x}),h=t=>n===t?y==="asc"?" ▲":" ▼":"";return e.jsxs("main",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[e.jsx(k,{title:"User Management",description:"Manage registered users.",canonical:"/admin/users"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"User Management"}),e.jsxs("p",{className:"text-gray-500 mb-8",children:[i.length," registered user",i.length!==1?"s":""]}),e.jsx("div",{className:"sharp-card bg-white overflow-hidden",children:i.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-6 py-3 text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsxs("th",{className:"text-left px-6 py-3 text-xs font-bold text-gray-500 uppercase tracking-wider cursor-pointer hover:text-blueprint-blue",onClick:()=>g("email"),children:["Email",h("email")]}),e.jsx("th",{className:"text-left px-6 py-3 text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Company"}),e.jsx("th",{className:"text-left px-6 py-3 text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Role"}),e.jsxs("th",{className:"text-left px-6 py-3 text-xs font-bold text-gray-500 uppercase tracking-wider cursor-pointer hover:text-blueprint-blue",onClick:()=>g("createdAt"),children:["Signed Up",h("createdAt")]}),e.jsxs("th",{className:"text-left px-6 py-3 text-xs font-bold text-gray-500 uppercase tracking-wider cursor-pointer hover:text-blueprint-blue",onClick:()=>g("lastLogin"),children:["Last Login",h("lastLogin")]}),e.jsx("th",{className:"text-left px-6 py-3 text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{children:i.map(t=>{const s=L(t.email),c=N===t.id;return e.jsxs("tr",{className:"border-t border-gray-100",children:[e.jsxs("td",{className:"px-6 py-4 text-sm font-medium text-gray-900",children:[e.jsxs("button",{onClick:()=>f(c?null:t.id),className:"text-left hover:text-blueprint-blue",children:[t.firstName," ",t.lastName,e.jsx("span",{className:"text-[10px] text-gray-400 ml-1",children:c?"▲":"▼"})]}),c&&e.jsxs("div",{className:"mt-3 p-4 bg-gray-50 border border-gray-200 text-xs space-y-2",children:[e.jsx("p",{className:"font-bold text-gray-700 uppercase tracking-wider mb-2",children:"Activity"}),e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-500",children:"User ID:"})," ",t.id]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-500",children:"Login count:"})," ",t.loginCount||1]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-500",children:"Orders:"})," ",s.length]}),s.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"font-bold text-gray-700 uppercase tracking-wider mb-1",children:"Purchase History"}),s.map((r,x)=>e.jsxs("div",{className:"py-1 border-b border-gray-100 last:border-0",children:[e.jsxs("p",{className:"text-gray-600",children:[new Date(r.createdAt).toLocaleDateString()," — $",r.total.toLocaleString()," — ",e.jsx("span",{className:r.status==="approved"?"text-green-600":r.status==="rejected"?"text-red-600":"text-yellow-600",children:r.status})]}),e.jsx("p",{className:"text-gray-400",children:r.items.map(U=>U.title).join(", ")})]},x))]})]})]}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:t.email}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:t.company||"—"}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("select",{value:t.role,onChange:r=>S(t.id,r.target.value),className:"text-[10px] font-bold uppercase px-2 py-1 border border-gray-200 bg-white cursor-pointer",children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"partner",children:"Partner"})]})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:new Date(t.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:new Date(t.lastLogin).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4",children:v===t.id?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>w(t.id),className:"text-[10px] font-bold uppercase px-3 py-1 bg-red-600 text-white hover:bg-red-700",children:"Confirm"}),e.jsx("button",{onClick:()=>m(null),className:"text-[10px] font-bold uppercase px-3 py-1 bg-gray-200 text-gray-600 hover:bg-gray-300",children:"Cancel"})]}):e.jsx("button",{onClick:()=>m(t.id),className:"text-[10px] font-bold uppercase px-3 py-1 text-red-600 hover:bg-red-50 border border-red-200",children:"Delete"})})]},t.id)})})]})}):e.jsxs("div",{className:"p-12 text-center text-gray-500",children:[e.jsx("p",{className:"text-lg mb-2",children:"No registered users yet."}),e.jsx("p",{className:"text-sm text-gray-400",children:"Users will appear here after they create accounts."})]})}),e.jsxs("div",{className:"mt-8 p-6 bg-gray-50 border border-gray-200",children:[e.jsx("h3",{className:"font-bold text-sm uppercase tracking-widest text-gray-500 mb-3",children:"Admin Setup"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["To configure admin emails, set the ",e.jsx("code",{className:"bg-gray-200 px-1 py-0.5 text-xs",children:"VITE_ADMIN_EMAILS"})," environment variable with a comma-separated list of email addresses."]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Example: ",e.jsx("code",{className:"bg-gray-200 px-1 py-0.5 text-xs",children:"VITE_ADMIN_EMAILS=admin@company.com,manager@company.com"})]}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"You can also promote any existing user to admin using the Role dropdown above."})]})]})}export{_ as default};
