import{a as y,j as e}from"./state-Cs2e8pUQ.js";import{L as de}from"./vendor-D7HEtn7k.js";import{m as me,h as pe,l as ge,n as he,R as xe}from"./index-Cmylodel.js";import{S as ue}from"./SEO-DxmzdYmc.js";import{R as k,A as J,C,X as A,Y as D,T as _,a as Q,B as E,b as $,P as fe,d as ye,e as be,L as ve}from"./charts-HkUfyz1_.js";const i={primary:"#1d4ed8",secondary:"#3b82f6",indigo:"#6366f1",sky:"#0ea5e9",violet:"#8b5cf6",teal:"#14b8a6",emerald:"#10b981",good:"#16a34a",warning:"#ca8a04",bad:"#dc2626"},K=[i.primary,i.secondary,i.indigo,i.sky,i.violet,i.teal,i.emerald],w={border:"1px solid #e5e7eb",borderRadius:0,fontFamily:"DM Sans, sans-serif",fontSize:12,boxShadow:"0 4px 6px -1px rgba(0,0,0,.1)"},u={fontSize:11,fill:"#6b7280",fontFamily:"DM Sans, sans-serif"},je={page_tagged:"Page View",cart_item_added:"Cart Add",cart_item_removed:"Cart Remove",checkout_started:"Checkout Started",checkout_completed:"Checkout Completed",login_completed:"Login",signup_completed:"Signup",migration_rom_generated:"ROM Generated",product_card_clicked:"Product Clicked",product_modal_tab_changed:"Modal Tab",category_filtered:"Category Filter",scroll_depth:"Scroll Depth",time_on_page:"Time on Page",chat_message_sent:"Chat Message",chat_opened:"Chat Opened",download_initiated:"Download Started",download_completed:"Download Complete",modal_interaction:"Modal Action",contact_form_submitted:"Contact Form",cta_clicked:"CTA Clicked"};function ke(a){return je[a]||a.replace(/_/g," ").replace(/\b\w/g,r=>r.toUpperCase())}function _e(a){const r=Date.now()-new Date(a).getTime(),c=Math.floor(r/6e4);if(c<1)return"just now";if(c<60)return`${c}m ago`;const m=Math.floor(c/60);return m<24?`${m}h ago`:`${Math.floor(m/24)}d ago`}function Z(a,r,c){const x=new Date(c).setHours(0,0,0,0),d=[];for(let l=r-1;l>=0;l--){const s=x-l*864e5,h=new Date(s);d.push({label:h.toLocaleDateString("en-US",{month:"short",day:"numeric"}),count:0})}for(const l of a){const s=new Date(l.timestamp).getTime(),h=r-1-Math.floor((x+864e5-s)/864e5);h>=0&&h<r&&d[h].count++}return d}function we(a){const r={Navigation:0,Commerce:0,Content:0,Migration:0,Engagement:0,Other:0},c=new Set(["page_tagged","$pageview","nav_link_clicked","bpcs_link_clicked","mega_menu_opened"]),m=new Set(["cart_item_added","cart_item_removed","checkout_started","checkout_completed","cart_viewed"]),x=new Set(["product_card_clicked","product_modal_opened","product_page_viewed","product_modal_tab_changed","category_filtered"]),d=new Set(["migration_assessment_started","migration_rom_generated","migration_section_completed"]),l=new Set(["scroll_depth","time_on_page","chat_message_sent","chat_opened","cta_clicked","download_initiated","download_completed","contact_form_submitted","modal_interaction"]);for(const s of a)c.has(s.event)?r.Navigation++:m.has(s.event)?r.Commerce++:x.has(s.event)?r.Content++:d.has(s.event)?r.Migration++:l.has(s.event)?r.Engagement++:r.Other++;return Object.entries(r).filter(([,s])=>s>0).map(([s,h])=>({name:s,value:h}))}function Se(a,r){let m=0,x=0,d=0,l=0,s=0;const h=[],b=[];for(const g of a){const v=r-new Date(g.timestamp).getTime();v<864e5&&m++,v<7*864e5&&x++,(g.event==="page_tagged"||g.event==="$pageview")&&d++,g.event==="checkout_completed"&&l++,g.event==="cart_item_added"&&s++,g.event==="scroll_depth"&&typeof g.properties.depth=="number"&&h.push(g.properties.depth),g.event==="time_on_page"&&typeof g.properties.durationSec=="number"&&b.push(g.properties.durationSec)}const N=d>0?l/d*100:0,B=s>0?(s-l)/s*100:0,M=h.length>0?h.reduce((g,v)=>g+v,0)/h.length:0,I=b.length>0?b.reduce((g,v)=>g+v,0)/b.length:0,P=Math.min(30,M/100*30),F=Math.min(30,Math.min(I,120)/120*30),R=Math.min(40,Math.min(a.length,200)/200*40),p=Math.round(P+F+R);return{events24h:m,events7d:x,conversionRate:N,pageViews:d,checkouts:l,cartAdds:s,cartAbandonment:B,engagementScore:p}}function Ne(a){let r=0,c=0,m=0,x=0,d=0;for(const s of a)(s.event==="page_tagged"||s.event==="$pageview")&&r++,s.event==="product_card_clicked"&&c++,s.event==="cart_item_added"&&m++,s.event==="checkout_started"&&x++,s.event==="checkout_completed"&&d++;const l=Math.max(r,1);return[{step:"Page Views",count:r,pct:100},{step:"Product Clicks",count:c,pct:Math.round(c/l*100)},{step:"Cart Adds",count:m,pct:Math.round(m/l*100)},{step:"Checkout Started",count:x,pct:Math.round(x/l*100)},{step:"Completed",count:d,pct:Math.round(d/l*100)}]}function Te(){const[a,r]=y.useState([]),[c,m]=y.useState([]),[x,d]=y.useState([]),[l,s]=y.useState([]),[h,b]=y.useState(!0),[N,B]=y.useState(0),[M,I]=y.useState("dashboard"),[P,F]=y.useState(7);y.useEffect(()=>{Promise.all([me(500),pe(),ge(),he()]).then(([t,f,T,O])=>{r(t),m(f),d(T),s(O),B(Date.now()),b(!1)})},[]);const R=y.useMemo(()=>{const t=N;if(!t)return null;const f=Se(a,t),T=Z(a,P,t),O=Z(c.map(n=>({timestamp:n.createdAt})),30,t),ae=we(a),se=Ne(a),G=new Map;for(const n of a)if(n.event==="page_tagged"||n.event==="$pageview"){const o=n.properties.pageName||n.page||"Unknown";G.set(o,(G.get(o)||0)+1)}const ne=[...G.entries()].sort((n,o)=>o[1]-n[1]).slice(0,8).map(([n,o])=>({name:n,value:o})),U=new Map;for(const n of a){const o=n.properties.productName;o&&U.set(o,(U.get(o)||0)+1)}const re=[...U.entries()].sort((n,o)=>o[1]-n[1]).slice(0,8).map(([n,o])=>({name:n,value:o})),L=new Map;for(const n of a)if(n.event==="time_on_page"&&typeof n.properties.durationSec=="number"){const o=n.properties.pageName||"Unknown";L.has(o)||L.set(o,[]),L.get(o).push(n.properties.durationSec)}const oe=[...L.entries()].map(([n,o])=>({name:n,value:Math.round(o.reduce((ce,le)=>ce+le,0)/o.length)})).sort((n,o)=>o.value-n.value).slice(0,8),V=new Map;for(const n of l)V.set(n.platformName,(V.get(n.platformName)||0)+1);const ie=[...V.entries()].sort((n,o)=>o[1]-n[1]).map(([n,o])=>({name:n,value:o}));return{kpis:f,activityTrend:T,signupTrend:O,eventCategories:ae,funnel:se,topPages:ne,topProducts:re,avgTimeOnPage:oe,assessmentsByPlatform:ie}},[a,c,l,N,P]);if(h||!R)return e.jsx("main",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-12",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center py-20",children:"Loading analytics..."})});const{kpis:p,activityTrend:g,signupTrend:v,eventCategories:Y,funnel:ee,topPages:W,topProducts:H,avgTimeOnPage:X,assessmentsByPlatform:q}=R,te=a.length===0;return e.jsxs("main",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[e.jsx(ue,{title:"Analytics Dashboard",description:"Site activity and analytics overview.",canonical:"/admin/analytics"}),e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100 mb-1",children:"Analytics Dashboard"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:[a.length.toLocaleString()," events tracked · ",c.length," users · ",x.length," orders"]})]}),e.jsx(de,{to:xe.ADMIN_DASHBOARD,className:"text-sm text-blueprint-blue hover:underline",children:"← Admin Portal"})]}),e.jsx("div",{className:"flex gap-1 border-b border-gray-200 dark:border-slate-700 mb-6",children:["dashboard","feed"].map(t=>e.jsx("button",{onClick:()=>I(t),className:`px-4 py-2 text-sm font-bold capitalize transition-colors border-b-2 ${M===t?"border-blueprint-blue text-blueprint-blue":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"}`,children:t==="dashboard"?"Dashboard":"Activity Feed"},t))}),M==="dashboard"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(z,{label:"Events (24h)",value:p.events24h,max:Math.max(p.events24h*1.5,50),suffix:"",color:i.primary,sub:`${p.events7d} in 7d`}),e.jsx(z,{label:"Conversion Rate",value:p.conversionRate,max:100,suffix:"%",color:p.conversionRate>5?i.good:p.conversionRate>1?i.warning:i.bad,sub:`${p.checkouts} of ${p.pageViews} visitors`}),e.jsx(z,{label:"Cart Abandon",value:p.cartAbandonment,max:100,suffix:"%",color:p.cartAbandonment<50?i.good:p.cartAbandonment<80?i.warning:i.bad,sub:`${p.cartAdds} cart adds`}),e.jsx(z,{label:"Engagement",value:p.engagementScore,max:100,suffix:"/100",color:p.engagementScore>60?i.good:p.engagementScore>30?i.warning:i.bad,sub:"Composite score"})]}),e.jsx(j,{title:"Activity Over Time",right:e.jsx("div",{className:"flex gap-1",children:[7,30].map(t=>e.jsxs("button",{onClick:()=>F(t),className:`px-3 py-1 text-xs font-bold transition-colors ${P===t?"bg-blueprint-blue text-white":"bg-gray-100 dark:bg-slate-700 text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-slate-600"}`,children:[t,"D"]},t))}),children:te?e.jsx(S,{}):e.jsx(k,{width:"100%",height:260,children:e.jsxs(J,{data:g,margin:{top:5,right:10,left:-10,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"grad-activity",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:i.primary,stopOpacity:.3}),e.jsx("stop",{offset:"100%",stopColor:i.primary,stopOpacity:.02})]})}),e.jsx(C,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(A,{dataKey:"label",tick:u}),e.jsx(D,{tick:u,allowDecimals:!1}),e.jsx(_,{contentStyle:w}),e.jsx(Q,{type:"monotone",dataKey:"count",stroke:i.primary,strokeWidth:2,fill:"url(#grad-activity)",name:"Events"})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(j,{title:"Top Pages",children:W.length===0?e.jsx(S,{}):e.jsx(k,{width:"100%",height:280,children:e.jsxs(E,{data:W,layout:"vertical",margin:{top:5,right:20,left:5,bottom:5},children:[e.jsx(C,{strokeDasharray:"3 3",stroke:"#e5e7eb",horizontal:!1}),e.jsx(A,{type:"number",tick:u,allowDecimals:!1}),e.jsx(D,{dataKey:"name",type:"category",tick:u,width:110}),e.jsx(_,{contentStyle:w}),e.jsx($,{dataKey:"value",fill:i.primary,barSize:18,name:"Views"})]})})}),e.jsx(j,{title:"Event Categories",children:Y.length===0?e.jsx(S,{}):e.jsx(k,{width:"100%",height:280,children:e.jsxs(fe,{children:[e.jsx(ye,{data:Y,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,paddingAngle:2,dataKey:"value",nameKey:"name",label:({name:t,percent:f})=>`${t??""} ${((f??0)*100).toFixed(0)}%`,labelLine:!1,children:Y.map((t,f)=>e.jsx(be,{fill:K[f%K.length]},f))}),e.jsx(_,{contentStyle:w}),e.jsx(ve,{iconType:"square",wrapperStyle:{fontSize:11}})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(j,{title:"Top Products",children:H.length===0?e.jsx(S,{}):e.jsx(k,{width:"100%",height:280,children:e.jsxs(E,{data:H,layout:"vertical",margin:{top:5,right:20,left:5,bottom:5},children:[e.jsx(C,{strokeDasharray:"3 3",stroke:"#e5e7eb",horizontal:!1}),e.jsx(A,{type:"number",tick:u,allowDecimals:!1}),e.jsx(D,{dataKey:"name",type:"category",tick:u,width:130}),e.jsx(_,{contentStyle:w}),e.jsx($,{dataKey:"value",fill:i.indigo,barSize:18,name:"Interactions"})]})})}),e.jsx(j,{title:"Avg. Time on Page (sec)",children:X.length===0?e.jsx(S,{}):e.jsx(k,{width:"100%",height:280,children:e.jsxs(E,{data:X,layout:"vertical",margin:{top:5,right:20,left:5,bottom:5},children:[e.jsx(C,{strokeDasharray:"3 3",stroke:"#e5e7eb",horizontal:!1}),e.jsx(A,{type:"number",tick:u,allowDecimals:!1}),e.jsx(D,{dataKey:"name",type:"category",tick:u,width:110}),e.jsx(_,{contentStyle:w}),e.jsx($,{dataKey:"value",fill:i.sky,barSize:18,name:"Seconds"})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(j,{title:"User Signups (30 days)",children:c.length===0?e.jsx(S,{}):e.jsx(k,{width:"100%",height:240,children:e.jsxs(J,{data:v,margin:{top:5,right:10,left:-10,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"grad-signups",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:i.teal,stopOpacity:.3}),e.jsx("stop",{offset:"100%",stopColor:i.teal,stopOpacity:.02})]})}),e.jsx(C,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(A,{dataKey:"label",tick:u}),e.jsx(D,{tick:u,allowDecimals:!1}),e.jsx(_,{contentStyle:w}),e.jsx(Q,{type:"monotone",dataKey:"count",stroke:i.teal,strokeWidth:2,fill:"url(#grad-signups)",name:"Signups"})]})})}),e.jsx(j,{title:"Assessments by Platform",children:q.length===0?e.jsx(S,{text:"No assessments yet"}):e.jsx(k,{width:"100%",height:240,children:e.jsxs(E,{data:q,margin:{top:5,right:10,left:-10,bottom:0},children:[e.jsx(C,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(A,{dataKey:"name",tick:u,interval:0,angle:-20,textAnchor:"end",height:50}),e.jsx(D,{tick:u,allowDecimals:!1}),e.jsx(_,{contentStyle:w}),e.jsx($,{dataKey:"value",fill:i.violet,barSize:28,name:"Assessments"})]})})})]}),e.jsx(j,{title:"Conversion Funnel",children:e.jsx("div",{className:"space-y-3",children:ee.map((t,f)=>{const T=Math.max(t.pct,4),O=K[f%K.length];return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-300 font-medium",children:t.step}),e.jsxs("span",{className:"text-gray-500 dark:text-gray-400 text-xs",children:[t.count.toLocaleString()," (",t.pct,"%)"]})]}),e.jsx("div",{className:"w-full bg-gray-100 dark:bg-slate-700 h-7 relative",children:e.jsx("div",{className:"h-7 transition-all flex items-center pl-2",style:{width:`${T}%`,backgroundColor:O},children:t.pct>10&&e.jsxs("span",{className:"text-white text-xs font-bold",children:[t.pct,"%"]})})})]},t.step)})})})]}),M==="feed"&&e.jsx("div",{className:"bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-700 divide-y divide-gray-100 dark:divide-slate-700 max-h-[600px] overflow-y-auto",children:a.length===0?e.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-sm text-center py-12",children:"No activity recorded yet. Browse the site to generate events."}):a.slice(0,100).map(t=>e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("span",{className:"inline-block px-2 py-0.5 bg-blue-50 dark:bg-blue-900/30 text-blueprint-blue text-xs font-bold whitespace-nowrap",children:ke(t.event)}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300 truncate",children:t.properties.pageName||t.properties.productName||t.properties.category||t.page}),t.userId&&e.jsxs("span",{className:"text-gray-400 text-xs truncate hidden md:inline",children:["user: ",t.userId.slice(0,8),"..."]})]}),e.jsx("span",{className:"text-gray-400 text-xs whitespace-nowrap ml-4",children:_e(t.timestamp)})]},t.id))})]})}function z({label:a,value:r,max:c,suffix:m,color:x,sub:d}){const s=Math.PI*55,h=Math.min(Math.max(r,0),c),b=c>0?h/c*s:0,N=m==="%"?r.toFixed(1):Math.round(r).toLocaleString();return e.jsxs("div",{className:"bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-700 border-t-4 border-t-blueprint-blue p-4 text-center",children:[e.jsxs("svg",{viewBox:"0 0 130 75",className:"w-full max-w-[160px] mx-auto",children:[e.jsx("path",{d:"M 10 70 A 55 55 0 0 1 120 70",fill:"none",stroke:"#e5e7eb",strokeWidth:"10",strokeLinecap:"butt"}),e.jsx("path",{d:"M 10 70 A 55 55 0 0 1 120 70",fill:"none",stroke:x,strokeWidth:"10",strokeLinecap:"butt",strokeDasharray:`${s}`,strokeDashoffset:`${s-b}`,style:{transition:"stroke-dashoffset 0.8s ease-out"}}),e.jsxs("text",{x:"65",y:"62",textAnchor:"middle",className:"text-xl",style:{fontSize:"20px",fontWeight:900,fill:"#111827",fontFamily:"DM Sans, sans-serif"},children:[N,m]})]}),e.jsx("p",{className:"text-xs font-bold uppercase tracking-wider text-gray-500 dark:text-gray-400 mt-1",children:a}),d&&e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-0.5",children:d})]})}function j({title:a,children:r,right:c}){return e.jsxs("div",{className:"bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-700 border-t-4 border-t-blueprint-blue p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-bold text-gray-900 dark:text-gray-100 text-sm uppercase tracking-wide",children:a}),c]}),r]})}function S({text:a}){return e.jsx("div",{className:"flex items-center justify-center h-48 text-gray-400 dark:text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("svg",{className:"w-10 h-10 mx-auto mb-2 opacity-40",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("p",{className:"text-sm",children:a||"No data yet. Browse the site to generate events."})]})})}export{Te as default};
